# Anv√§nd Python 3.9 som basbild
FROM python:3.9

# Skapa en icke-root-anv√§ndare
RUN useradd -m flaskuser

# S√§tt arbetskatalog
WORKDIR /app

# Kopiera bara requirements.txt f√∂rst f√∂r att optimera byggtiden
COPY requirements.txt /app/

# Installera Python-paket
RUN pip install --no-cache-dir -r requirements.txt

# Kopiera resterande filer
COPY . /app
COPY templates /app/templates

# üõë Skapa flaggorna p√• r√§tt plats:
RUN mkdir -p /root/ /app/flags/ \
    && echo "O24{command_of_the_pharaoh}" > /root/true_flag.txt \
    && echo "O24{almost_there_but_not}" > /app/flags/ancient_curse.txt

# √Ñndra √§gare till flaskuser (f√∂r /app/)
RUN chown -R flaskuser:flaskuser /app

# Byt till icke-root-anv√§ndaren
USER flaskuser

# Exponera Flask-porten
EXPOSE 6002

# Starta Flask med Gunicorn f√∂r b√§ttre prestanda
CMD ["gunicorn", "--bind", "0.0.0.0:6002", "app:app"]
